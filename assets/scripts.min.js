var showDebug=!0,GlucoDiary=GlucoDiary||{},Highcharts,chart,GDoptions;GlucoDiary.report=function(n,t){showDebug&&(navigator.notification?navigator.notification.alert(n,null,t,"OK"):alert(t?t+": "+n:n))};window.onload=function(){GlucoDiary.report("window.onload","Info");GlucoDiary.CheckSupportsStorage()&&GlucoDiary.CheckSupportsAppCache()?(GlucoDiary.CheckIfOnline(),GlucoDiary.InitInteractionListeners(),GlucoDiary.HighChart()):document.getElementById("errormessage").innerHTML="Your Browser does not support local storage and offline web apps.<br />Please change/update your browser."};GlucoDiary.InitInteractionListeners=function(){document.getElementById("GDcarbs").onclick=function(){document.getElementById("inputCarbsReading").scrollIntoView();document.getElementById("carbsUnits").focus();document.getElementById("carbsUnits").select()};document.getElementById("carbsUnits").onclick=function(){this.select()};document.getElementById("carbsUnits").onkeydown=function(n){n.keyCode===13&&GlucoDiary.SaveCarbsReading()};document.getElementById("GDinsulin").onclick=function(){document.getElementById("inputInsulinReading").scrollIntoView();document.getElementById("insulinUnits").focus();document.getElementById("insulinUnits").select()};document.getElementById("insulinUnits").onclick=function(){this.select()};document.getElementById("insulinUnits").onkeydown=function(n){n.keyCode===13&&GlucoDiary.SaveInsulinReading()};document.getElementById("GDglucose").onclick=function(){document.getElementById("inputGlucoseReading").scrollIntoView();document.getElementById("glucoseUnits").focus();document.getElementById("glucoseUnits").select()};document.getElementById("glucoseUnits").onclick=function(){this.select()};document.getElementById("glucoseUnits").onkeydown=function(n){n.keyCode===13&&GlucoDiary.SaveGlucoseReading()};document.getElementById("GDbkgnd").onclick=function(){document.getElementById("inputBkgndReading").scrollIntoView();document.getElementById("bkgndUnits").focus();document.getElementById("bkgndUnits").select()};document.getElementById("bkgndUnits").onclick=function(){this.select()};document.getElementById("bkgndUnits").onkeydown=function(n){n.keyCode===13&&GlucoDiary.SaveBkgndReading()}};GDoptions={chart:{renderTo:"highcharts",height:300,width:320},global:{useUTC:!1},title:{text:"Last 5 Days"},tooltip:{enabled:!1},xAxis:{type:"datetime",title:""},yAxis:{title:""},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{states:{hover:{enabled:!1}},type:"areaspline",name:"Glucose",data:[],color:"#DA4453",lineColor:"#DA4453",fillOpacity:.3,animation:!1},{type:"column",name:"Carbs",data:[],color:"#8CC152",animation:!1},{type:"line",name:"Rapid Insulin",data:[],color:"#3BAFDA",animation:!1}]};GlucoDiary.HighChart=function(){GlucoDiary.ReadLocalStorage();chart=new Highcharts.Chart(GDoptions)};GlucoDiary.CheckSupportsStorage=function(){return window.localStorage?(document.getElementById("infomessage").innerHTML+="Local Storage is available for use<br />",!0):!1};GlucoDiary.CheckIfOnline=function(){document.getElementById("errormessage").innerHTML+=navigator.onLine?"Online<br />":"Offline<br />"};GlucoDiary.CheckSupportsAppCache=function(){return window.applicationCache?(document.getElementById("infomessage").innerHTML+="Application Cache is available for use<br />",!0):!1};GlucoDiary.ReadLocalStorage=function(){var n,r,o,s,h,l,t,c,i,u,f,e;for(e='<table width="100%" border="0" style="border-collapse: collapse;">',o=[],s=[],h=[],l=[],u="#CCC",i=new Date,i=Date.UTC(i.getFullYear(),i.getUTCMonth(),i.getDate()-5,i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()).toString(),i=i.substring(0,i.length-3),n=0;n<localStorage.length;n++){t=Date.UTC(localStorage.key(n).substr(6,4),localStorage.key(n).substr(10,2),localStorage.key(n).substr(12,2),localStorage.key(n).substr(15,2),localStorage.key(n).substr(17,2),localStorage.key(n).substr(19,2)).toString();t=t.substring(0,t.length-3);c=localStorage.key(n).substr(15,2)+":"+localStorage.key(n).substr(17,2)+":"+localStorage.key(n).substr(19,2)+" "+localStorage.key(n).substr(12,2)+"/"+(parseInt(localStorage.key(n).substr(10,2),10)+1)+"/"+localStorage.key(n).substr(6,4);r=localStorage.key(n);switch(r.substring(0,5)){case"gluco":t>i&&(u="#DA4453",f="Glucose",h.push("["+[t+"000",localStorage.getItem(r)]+"]"));break;case"carbs":t>i&&(u="#8CC152",f="Carbs",s.push("["+[t+"000",localStorage.getItem(r)]+"]"));break;case"bkgnd":t>i&&(f="Bkgnd Insulin",u="#967ADC");break;case"rapid":t>i&&(f="Insulin",u="#3BAFDA",o.push("["+[t+"000",localStorage.getItem(r)]+"]"));break;case"insul":t=Date.UTC(localStorage.key(n).substr(8,4),localStorage.key(n).substr(12,2),localStorage.key(n).substr(14,2),localStorage.key(n).substr(17,2),localStorage.key(n).substr(19,2),localStorage.key(n).substr(21,2)).toString();t=t.substring(0,t.length-3);t>i&&(c=localStorage.key(n).substr(17,2)+":"+localStorage.key(n).substr(19,2)+":"+localStorage.key(n).substr(21,2)+" "+localStorage.key(n).substr(14,2)+"/"+(parseInt(localStorage.key(n).substr(12,2),10)+1)+"/"+localStorage.key(n).substr(8,4),f="Insulin",u="#3BAFDA",o.push("["+[t+"000",localStorage.getItem(r)]+"]"));break;default:return}t>i&&(e+='<tr style="border-top:solid 1px #EEE;"><td style="border-left:solid 7px'+u+';">'+f+" ("+n+")<\/td><td>"+c+"<\/td><td>"+localStorage.getItem(r)+"<\/td><\/tr>",e+='<tr><td colspan="3">&nbsp;<\/td><\/tr>')}e+="<\/table>";document.getElementById("dataStatusMessage").innerHTML=e;GDoptions.series[0].data=JSON.parse("["+h.sort()+"]");GDoptions.series[1].data=JSON.parse("["+s.sort()+"]");GDoptions.series[2].data=JSON.parse("["+o.sort()+"]")};GlucoDiary.SaveGlucoseReading=function(){if(typeof Storage!="undefined"){var n,t;document.getElementById("glucoseUnits").value===""||document.getElementById("glucoseUnits").value==="0"?(document.getElementById("errormessage").innerHTML="Please select a value before clicking SAVE",document.getElementById("errormessage").scrollIntoView()):(n=new Date,t=[n.getFullYear(),("0"+n.getMonth()).slice(-2),("0"+n.getDate()).slice(-2),"_",("0"+n.getHours()).slice(-2),("0"+n.getMinutes()).slice(-2),("0"+n.getSeconds()).slice(-2)].join(""),localStorage["gluco_"+t]=parseFloat(document.getElementById("glucoseUnits").value),document.getElementById("glucoseUnits").value="0",document.getElementById("errormessage").innerHTML="",document.getElementById("infomessage").innerHTML="Data Saved",document.getElementById("container").scrollIntoView(),GlucoDiary.HighChart())}else document.getElementById("errormessage").innerHTML+="Cannot save :(<br />",document.getElementById("errormessage").scrollIntoView()};GlucoDiary.SaveCarbsReading=function(){if(typeof Storage!="undefined"){var n,t;document.getElementById("carbsUnits").value===""||document.getElementById("carbsUnits").value==="0"?(document.getElementById("errormessage").innerHTML="Please select a value before clicking SAVE",document.getElementById("errormessage").scrollIntoView()):(n=new Date,t=[n.getFullYear(),("0"+n.getMonth()).slice(-2),("0"+n.getDate()).slice(-2),"_",("0"+n.getHours()).slice(-2),("0"+n.getMinutes()).slice(-2),("0"+n.getSeconds()).slice(-2)].join(""),localStorage["carbs_"+t]=parseFloat(document.getElementById("carbsUnits").value),document.getElementById("carbsUnits").value="0",document.getElementById("errormessage").innerHTML="",document.getElementById("infomessage").innerHTML="Data Saved",document.getElementById("container").scrollIntoView(),GlucoDiary.HighChart())}else document.getElementById("errormessage").innerHTML+="Cannot save :(<br />",document.getElementById("errormessage").scrollIntoView()};GlucoDiary.SaveInsulinReading=function(){if(typeof Storage!="undefined"){var n,t;document.getElementById("insulinUnits").value===""||document.getElementById("insulinUnits").value==="0"?(document.getElementById("errormessage").innerHTML="Please select a value before clicking SAVE",document.getElementById("errormessage").scrollIntoView()):(n=new Date,t=[n.getFullYear(),("0"+n.getMonth()).slice(-2),("0"+n.getDate()).slice(-2),"_",("0"+n.getHours()).slice(-2),("0"+n.getMinutes()).slice(-2),("0"+n.getSeconds()).slice(-2)].join(""),localStorage["rapid_"+t]=parseFloat(document.getElementById("insulinUnits").value),document.getElementById("insulinUnits").value="0",document.getElementById("errormessage").innerHTML="",document.getElementById("infomessage").innerHTML="Data Saved",document.getElementById("container").scrollIntoView(),GlucoDiary.HighChart())}else document.getElementById("errormessage").innerHTML+="Cannot save :(<br />",document.getElementById("errormessage").scrollIntoView()};GlucoDiary.SaveBkgndReading=function(){if(typeof Storage!="undefined"){var n,t;document.getElementById("bkgndUnits").value===""||document.getElementById("bkgndUnits").value==="0"?(document.getElementById("errormessage").innerHTML="Please select a value before clicking SAVE",document.getElementById("errormessage").scrollIntoView()):(n=new Date,t=[n.getFullYear(),("0"+n.getMonth()).slice(-2),("0"+n.getDate()).slice(-2),"_",("0"+n.getHours()).slice(-2),("0"+n.getMinutes()).slice(-2),("0"+n.getSeconds()).slice(-2)].join(""),localStorage["bkgnd_"+t]=parseFloat(document.getElementById("bkgndUnits").value),document.getElementById("bkgndUnits").value="0",document.getElementById("errormessage").innerHTML="",document.getElementById("infomessage").innerHTML="Data Saved",document.getElementById("container").scrollIntoView(),GlucoDiary.HighChart())}else document.getElementById("errormessage").innerHTML+="Cannot save :(<br />",document.getElementById("errormessage").scrollIntoView()}